/*!
 * hash-wasm (https://www.npmjs.com/package/hash-wasm)
 * (c) Dani Biro
 * @license MIT
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).hashwasm=e.hashwasm||{})}(this,(function(e){"use strict";function t(e,t,A,n){return new(A||(A=Promise))((function(r,o){function i(e){try{s(n.next(e))}catch(e){o(e)}}function a(e){try{s(n.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof A?t:new A((function(e){e(t)}))).then(i,a)}s((n=n.apply(e,t||[])).next())}))}class A{constructor(){this.mutex=Promise.resolve()}lock(){let e=()=>{};return this.mutex=this.mutex.then((()=>new Promise(e))),new Promise((t=>{e=t}))}dispatch(e){return t(this,void 0,void 0,(function*(){const t=yield this.lock();try{return yield Promise.resolve(e())}finally{t()}}))}}var n;const r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,o=null!==(n=r.Buffer)&&void 0!==n?n:null,i=r.TextEncoder?new r.TextEncoder:null;function a(e,t){return(15&e)+(e>>6|e>>3&8)<<4|(15&t)+(t>>6|t>>3&8)}const s="a".charCodeAt(0)-10,c="0".charCodeAt(0);function B(e,t,A){let n=0;for(let r=0;r<A;r++){let A=t[r]>>>4;e[n++]=A>9?A+s:A+c,A=15&t[r],e[n++]=A>9?A+s:A+c}return String.fromCharCode.apply(null,e)}const f=null!==o?e=>{if("string"==typeof e){const t=o.from(e,"utf8");return new Uint8Array(t.buffer,t.byteOffset,t.length)}if(o.isBuffer(e))return new Uint8Array(e.buffer,e.byteOffset,e.length);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")}:e=>{if("string"==typeof e)return i.encode(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Invalid data type!")},h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=new Uint8Array(256);for(let e=0;e<h.length;e++)l[h.charCodeAt(e)]=e;function g(e){const t=function(e){let t=Math.floor(.75*e.length);const A=e.length;return"="===e[A-1]&&(t-=1,"="===e[A-2]&&(t-=1)),t}(e),A=e.length,n=new Uint8Array(t);let r=0;for(let t=0;t<A;t+=4){const A=l[e.charCodeAt(t)],o=l[e.charCodeAt(t+1)],i=l[e.charCodeAt(t+2)],a=l[e.charCodeAt(t+3)];n[r]=A<<2|o>>4,r+=1,n[r]=(15&o)<<4|i>>2,r+=1,n[r]=(3&i)<<6|63&a,r+=1}return n}const u=16384,Q=new A,d=new Map;function E(e,A){return t(this,void 0,void 0,(function*(){let n=null,r=null,o=!1;if("undefined"==typeof WebAssembly)throw new Error("WebAssembly is not supported in this environment!");const i=()=>new DataView(n.exports.memory.buffer).getUint32(n.exports.STATE_SIZE,!0),s=Q.dispatch((()=>t(this,void 0,void 0,(function*(){if(!d.has(e.name)){const t=g(e.data),A=WebAssembly.compile(t);d.set(e.name,A)}const t=yield d.get(e.name);n=yield WebAssembly.instantiate(t,{})})))),c=(e=null)=>{o=!0,n.exports.Hash_Init(e)},h=e=>{if(!o)throw new Error("update() called before init()");(e=>{let t=0;for(;t<e.length;){const A=e.subarray(t,t+u);t+=A.length,r.set(A),n.exports.Hash_Update(A.length)}})(f(e))},l=new Uint8Array(2*A),E=(e,t=null)=>{if(!o)throw new Error("digest() called before init()");return o=!1,n.exports.Hash_Final(t),"binary"===e?r.slice(0,A):B(l,r,A)},y=e=>"string"==typeof e?e.length<4096:e.byteLength<u;let I=y;switch(e.name){case"argon2":case"scrypt":I=()=>!0;break;case"blake2b":case"blake2s":I=(e,t)=>t<=512&&y(e);break;case"blake3":I=(e,t)=>0===t&&y(e);break;case"xxhash64":case"xxhash3":case"xxhash128":I=()=>!1}return yield(()=>t(this,void 0,void 0,(function*(){n||(yield s);const e=n.exports.Hash_GetBuffer(),t=n.exports.memory.buffer;r=new Uint8Array(t,e,u)})))(),{getMemory:()=>r,writeMemory:(e,t=0)=>{r.set(e,t)},getExports:()=>n.exports,setMemorySize:e=>{n.exports.Hash_SetMemorySize(e);const t=n.exports.Hash_GetBuffer(),A=n.exports.memory.buffer;r=new Uint8Array(A,t,e)},init:c,update:h,digest:E,save:()=>{if(!o)throw new Error("save() can only be called after init() and before digest()");const t=n.exports.Hash_GetState(),A=i(),r=n.exports.memory.buffer,s=new Uint8Array(r,t,A),c=new Uint8Array(4+A);return function(e,t){const A=t.length>>1;for(let n=0;n<A;n++){const A=n<<1;e[n]=a(t.charCodeAt(A),t.charCodeAt(A+1))}}(c,e.hash),c.set(s,4),c},load:t=>{if(!(t instanceof Uint8Array))throw new Error("load() expects an Uint8Array generated by save()");const A=n.exports.Hash_GetState(),r=i(),s=4+r,c=n.exports.memory.buffer;if(t.length!==s)throw new Error(`Bad state length (expected ${s} bytes, got ${t.length})`);if(!function(e,t){if(e.length!==2*t.length)return!1;for(let A=0;A<t.length;A++){const n=A<<1;if(t[A]!==a(e.charCodeAt(n),e.charCodeAt(n+1)))return!1}return!0}(e.hash,t.subarray(0,4)))throw new Error("This state was written by an incompatible hash implementation");const B=t.subarray(4);new Uint8Array(c,A,r).set(B),o=!0},calculate:(e,t=null,o=null)=>{if(!I(e,t))return c(t),h(e),E("hex",o);const i=f(e);return r.set(i),n.exports.Hash_Calculate(i.length,t,o),B(l,r,A)},hashLength:A}}))}var y={name:"crc32",data:"AGFzbQEAAAABDANgAAF/YAAAYAF/AAMIBwABAQIBAAIEBQFwAQEBBQQBAQICBg4CfwFBkMkFC38AQYAICwdwCAZtZW1vcnkCAA5IYXNoX0dldEJ1ZmZlcgAACUhhc2hfSW5pdAACC0hhc2hfVXBkYXRlAAMKSGFzaF9GaW5hbAAEDUhhc2hfR2V0U3RhdGUABQ5IYXNoX0NhbGN1bGF0ZQAGClNUQVRFX1NJWkUDAQrjBwcFAEGACQvjAwEEf0GAiQEhAEEAIQEDQCAAQQBBAEEAQQAgAUEBdiICQQFxa0GghuLtfnFBACABQQFxa0GghuLtfnEgAnNBAXYiAnNBAXYiA0EBcWtBoIbi7X5xQQAgAkEBcWtBoIbi7X5xIANzQQF2IgJzQQF2IgNBAXFrQaCG4u1+cUEAIAJBAXFrQaCG4u1+cSADc0EBdiICc0EBdiIDQQFxa0GghuLtfnFBACACQQFxa0GghuLtfnEgA3NBAXZzNgIAIABBBGohACABQQFqIgFBgAJHDQALQQAhAQNAIAFBhJEBaiABQYSJAWooAgAiAEH/AXFBAnRBgIkBaigCACAAQQh2cyIANgIAIAFBhJkBaiAAQf8BcUECdEGAiQFqKAIAIABBCHZzIgA2AgAgAUGEoQFqIABB/wFxQQJ0QYCJAWooAgAgAEEIdnMiADYCACABQYSpAWogAEH/AXFBAnRBgIkBaigCACAAQQh2cyIANgIAIAFBhLEBaiAAQf8BcUECdEGAiQFqKAIAIABBCHZzIgA2AgAgAUGEuQFqIABB/wFxQQJ0QYCJAWooAgAgAEEIdnMiADYCACABQYTBAWogAEH/AXFBAnRBgIkBaigCACAAQQh2czYCACABQQRqIgFB/AdHDQALCyIAAkBBAC0AgMkBDQAQAUEAQQE6AIDJAQtBAEEANgKEyQELwQIBBn9BACgChMkBQX9zIQFBgAkhAgJAIABBCEkNACAAQXhqIgNBeHEiBEEIaiEFQYAJIQIDQCACQQRqKAIAIgZBDnZB/AdxQYCRAWooAgAgBkEWdkH8B3FBgIkBaigCAHMgBkEGdkH8B3FBgJkBaigCAHMgBkH/AXFBAnRBgKEBaigCAHMgAigCACABcyIBQRZ2QfwHcUGAqQFqKAIAcyABQQ52QfwHcUGAsQFqKAIAcyABQQZ2QfwHcUGAuQFqKAIAcyABQf8BcUECdEGAwQFqKAIAcyEBIAJBCGohAiAAQXhqIgBBB0sNAAsgAyAEayEAIAVBgAlqIQILAkAgAEUNAANAIAFB/wFxIAItAABzQQJ0QYCJAWooAgAgAUEIdnMhASACQQFqIQIgAEF/aiIADQALC0EAIAFBf3M2AoTJAQszAQF/QQBBACgChMkBIgBBGHQgAEEIdEGAgPwHcXIgAEEIdkGA/gNxIABBGHZycjYCgAkLBgBBhMkBC1UAAkBBAC0AgMkBDQAQAUEAQQE6AIDJAQtBAEEANgKEyQEgABADQQBBACgChMkBIgBBGHQgAEEIdEGAgPwHcXIgAEEIdkGA/gNxIABBGHZycjYCgAkLCwsBAEGACAsEBAAAAA==",hash:"6a8ec701"};const I=new A;let C=null;e.crc32=function(e){if(null===C)return function(e,A,n){return t(this,void 0,void 0,(function*(){const t=yield e.lock(),r=yield E(A,n);return t(),r}))}(I,y,4).then((t=>(C=t,C.calculate(e))));try{const t=C.calculate(e);return Promise.resolve(t)}catch(e){return Promise.reject(e)}},e.createCRC32=function(){return E(y,4).then((e=>{e.init();const t={init:()=>(e.init(),t),update:A=>(e.update(A),t),digest:t=>e.digest(t),save:()=>e.save(),load:A=>(e.load(A),t),blockSize:4,digestSize:4};return t}))},Object.defineProperty(e,"__esModule",{value:!0})}));
